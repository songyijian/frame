<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        body {
            background: #CCCCCC;
        }
        
        #item1 {
            width: 750px;
            margin: 0 auto;
            /*border: 1px solid red*/
            background: #FFFFFF;
            padding: 1rem;
        }
        
        ul {
            margin: 0;
            padding: 0;
        }
        
        li {
            border-top: 1px solid #ccc;
            padding: 0.5rem;
            list-style: none;
        }
        
        li span {
            cursor: pointer;
            border-radius: 50%;
            display: inline-block;
            height: 22px;
            width: 22px;
            border: 1px solid #CCCCCC;
            background: #CCCCCC;
            text-align: center;
            font: 12px/22px "微软雅黑";
        }
        
        .content {
            border: 1px solid #ccc;
        }
        
        li input[type="text"] {
            display: none;
        }
        
        .edit input[type="text"] {
            display: inline-block;
        }
        
        .edit em {
            display: none;
        }
        
        .state em {
            text-decoration: line-through;
            color: #CCCCCC;
        }
    </style>
</head>

<body>
    <div id="item1">
        <h2>添加任务</h2>
        <input type="" v-model="addTxt" @keyup.13="getVlue" /><button @click="getVlue">{{btnName}}</button>
        <p v-if="states">{{states}}个任务未完成！</p>
        <p v-else>任务已经全部完成！</p>
        <h2>列表</h2>
        <div class="content">
            <p v-show="!overs">当前没有任何数据</p>
            <ul>
                <li v-for="(item,index) in list" v-bind:class="{state:item.state}">
                    <input type="checkbox" value="item.state" v-model="item.state" />
                    <em>{{item.title}}</em>
                    <input type="text" v-model.trim="item.title" />
                    <span v-on:click="remov(index)">X</span>
                </li>
            </ul>
        </div>
    </div>


    <script src="../src/vue.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
        try {
            var ls = localStorage.getItem("listdata")
                // var ls = localStorage.setItem("listdata", JSON.stringify(ls))
            ls = JSON.parse(ls)
        } catch (err) {
            var ls = []
        }

        new Vue({
            el: "#item1",
            data: {
                btnName: "添加任务",
                addTxt: "",
                list: ls
            },
            methods: {
                getVlue(ev) {
                    if (this.addTxt.trim() !== '') {
                        this.list.splice(0, 0, {
                                title: this.addTxt,
                                state: false
                            })
                            // this.list.push({
                            //     title: this.addTxt,
                            //     state: false
                            // })
                    }
                    this.addTxt = ""
                },
                remov(index) {
                    this.list.splice(index, 1);
                }
            },
            computed: {
                overs() {
                    return this.list.length ? true : false;
                },
                states() {
                    let array = this.list.filter((item) => {
                        return item.state === false;
                    })
                    return array.length;
                }
            },
            watch: {
                list: {
                    handler() {
                        console.log("set");
                        localStorage.setItem("listdata", JSON.stringify(ls));
                    },
                    deep: true
                }
            }
        });
    </script>
</body>

</html>